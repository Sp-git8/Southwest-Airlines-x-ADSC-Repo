<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title></title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" crossorigin=""/>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif !important;
        }

        body {
            background-color: black;
            color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            overflow-x: hidden;
            overflow-y: hidden;
        }

        h1 {
            margin-top: 20px;
            font-size: 24px;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            font-weight: 400;
            letter-spacing: 0.5px;
            text-transform: capitalize;
            text-align: center;
        }

        #map {
            width: 90%;
            height: 560px;
            margin: 10px auto; 
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(255, 255, 255, 0.2);
        }

        #dropdown {
            display: none;
        }

        .dropdown-container {
            position: relative;
            display: inline-block;
            margin-top: -22px;
        }

        .dropdown-button {
            background: #1a1a1a;
            color: #ffffff;
            border: none;
            border-radius: 4px;
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 400;
            letter-spacing: 0.5px;
            text-transform: uppercase;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .dropdown-button:hover {
            background: #333333;
        }

        .dropdown-menu {
            display: none;
            position: absolute;
            background: #1a1a1a;
            border-radius: 4px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            margin-top: 5px;
            z-index: 1000;
            max-height: 220px;
            overflow-y: auto;
        }

        .dropdown-menu.show {
            display: block;
        }

        .dropdown-item {
            padding: 10px 20px;
            color: #ffffff;
            text-align: center;
            cursor: pointer;
            transition: background 0.3s ease;
            border-bottom: 1px solid white;
        }

        .dropdown-item:last-child {
            border-bottom: none;
        }

        .dropdown-item:hover {
            background: #333333;
        }

        #key {
            margin: 12px auto;
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 90%;
        }

        .key-bar {
            width: 100%;
            height: 18px;
            background: linear-gradient(to right, #00e400, #a3e400, #ffff00, #ffcc00, #ff7e00, #ff3f00, #ff0000, #a3005c, #8f3f97);
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(255, 255, 255, 0.2);
        }

        .key-labels {
            display: flex;
            justify-content: space-between;
            width: 100%;
            margin-top: 10px;
        }

        .key-label {
            font-size: 14px;
            color: #ffffff;
            font-family: inherit;
            font-weight: 400;
            letter-spacing: 0.5px;
            text-transform: uppercase;
        }

        .custom-popup {
            background: black !important;
            border: 1px solid black !important;
            border-radius: 5px !important;
            color: white !important;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif !important;
        }

        .custom-popup .leaflet-popup-content-wrapper {
            background: black !important;
            border-radius: 5px !important;
        }

        .custom-popup .leaflet-popup-tip {
            background: black !important;
        }

        .dropdown-menu::-webkit-scrollbar {
            width: 8px;
        }

        .dropdown-menu::-webkit-scrollbar-thumb {
            background: #333333;
            border-radius: 4px;
        }

        .dropdown-menu::-webkit-scrollbar-thumb:hover {
            background: #555555;
        }



        #reset-view {
            position: absolute;
            top: 10px;
            left: 10px;
            z-index: 1000;
            background: #1a1a1a;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 10px 20px;
            cursor: pointer;
        }

        #reset-view:hover {
            background: #333333;
        }

        h2 {
            text-align: center;
            margin-bottom: -14px;
            font-size: 16px;
            font-family: inherit;
            color: #ffffff;
            font-weight: 400;
            letter-spacing: 0.5px;
            text-transform: uppercase;
            background: none;
            border: none;
            padding: 0;
        }

        .leaflet-control-zoom-in,
        .leaflet-control-zoom-out {
            background: black !important;
            color: white !important;
            border: none !important;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex !important;
            align-items: center !important;
            justify-content: center !important;
            font-size: 18px;
            cursor: pointer;
            box-sizing: border-box;
            transform: rotate(180deg);
        }

        .leaflet-bar {
            border: none !important;
            box-shadow: none !important;
        }

        .leaflet-control-custom {
            border: none !important;
            box-shadow: none !important;
        }
    </style>
</head>
<body>
    <h1>Weather Score Project</h1>
    <div id="map"></div>

    <h2 style="text-align: center; margin-bottom: -10px; margin-top: -6px; font-size: 16px;">Weather Score</h2>

    <div id="key">
        <div class="key-bar"></div>
        <div class="key-labels">
            <span class="key-label">0</span>
            <span class="key-label">20</span>
            <span class="key-label">40</span>
            <span class="key-label">60</span>
            <span class="key-label">80</span>
            <span class="key-label">100</span>
        </div>
    </div>

    <div class="dropdown-container">
        <button class="dropdown-button">Select an airport</button>
        <div class="dropdown-menu">
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" crossorigin=""></script>
    <script src="https://unpkg.com/@turf/turf@6.5.0/turf.min.js"></script>
    <script>
        const airports = [
            { name: "Los Angeles International Airport", code: "LAX", lat: 33.9416, lon: -118.4085, score: 85 },
            { name: "John F. Kennedy International Airport", code: "JFK", lat: 40.6413, lon: -73.7781, score: 70 },
            { name: "Chicago O'Hare International Airport", code: "ORD", lat: 41.9742, lon: -87.9073, score: 90 },
            { name: "Dallas/Fort Worth International Airport", code: "DFW", lat: 32.8998, lon: -97.0403, score: 60 },
            { name: "Denver International Airport", code: "DEN", lat: 39.8561, lon: -104.6737, score: 50 },
            { name: "San Francisco International Airport", code: "SFO", lat: 37.7749, lon: -122.4194, score: 75 },
            { name: "Seattle-Tacoma International Airport", code: "SEA", lat: 47.6062, lon: -122.3321, score: 65 },
            { name: "Miami International Airport", code: "MIA", lat: 25.7617, lon: -80.1918, score: 55 },
            { name: "Hartsfield-Jackson Atlanta International Airport", code: "ATL", lat: 33.6407, lon: -84.4277, score: 95 },
            { name: "Phoenix Sky Harbor International Airport", code: "PHX", lat: 33.4484, lon: -112.0740, score: 80 }
        ];

        const map = L.map('map', {
            center: [37.0902, -95.7129],
            zoom: 4,
            attributionControl: false
        });

        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 19,
            attribution: ''
        }).addTo(map);

        map.setView([37.0902, -95.7129], 4);

        function getColor(score) {
            if (score <= 20) return "#00e400";
            if (score <= 40) return "#ffff00";
            if (score <= 60) return "#ff7e00";
            if (score <= 80) return "#ff0000";
            return "#8f3f97";
        }

        function getCircleSize(score) {
            const minSize = 5000;
            const maxSize = 100000;
            return minSize + (maxSize - minSize) * (score / 100);
        }

        function getZoomLevel(circleRadius) {
            const minZoom = 6;
            const maxZoom = 11;
            const minSize = 5000;
            const maxSize = 100000;
            return maxZoom - ((circleRadius - minSize) / (maxSize - minSize)) * (maxZoom - minZoom);
        }

        const dropdownButton = document.querySelector('.dropdown-button');
        const dropdownMenu = document.querySelector('.dropdown-menu');
        const markers = {};

        airports.forEach(airport => {
            const color = getColor(airport.score);
            const size = getCircleSize(airport.score);

            const marker = L.circle([airport.lat, airport.lon], {
                color: color,
                fillColor: color,
                fillOpacity: 0.7,
                radius: size
            }).addTo(map)
            .bindPopup(L.popup({
                className: 'custom-popup',
                closeButton: false
            }).setContent(`<div style='color: white; padding: 5px;'>Score: ${airport.score}</div>`));

            const popupStyle = document.createElement('style');
            popupStyle.innerHTML = `
                .custom-popup {
                    background: black !important;
                    border: 1px solid black !important;
                    border-radius: 5px !important;
                    color: white !important;
                }
                .custom-popup .leaflet-popup-content-wrapper {
                    background: black !important;
                    border-radius: 5px !important;
                }
                .custom-popup .leaflet-popup-tip {
                    background: black !important;
                }
            `;
            document.head.appendChild(popupStyle);

            markers[airport.code] = { marker: marker, size: size };

            const button = document.createElement('div');
            button.className = 'dropdown-item';
            button.textContent = `${airport.name.replace('International Airport', 'International')} (${airport.code})`;
            button.addEventListener('click', () => {
                const markerData = markers[airport.code];
                if (markerData) {
                    map.closePopup();
                    const zoomLevel = getZoomLevel(markerData.size);
                    map.setView(markerData.marker.getLatLng(), zoomLevel);
                    setTimeout(() => markerData.marker.openPopup(), 100);
                }
                dropdownMenu.classList.remove('show');
            });
            dropdownMenu.appendChild(button);
        });

        dropdownButton.addEventListener('click', () => {
            dropdownMenu.classList.toggle('show');
        });

        window.addEventListener('click', (event) => {
            if (!event.target.matches('.dropdown-button')) {
                const dropdowns = document.getElementsByClassName("dropdown-menu");
                for (let i = 0; i < dropdowns.length; i++) {
                    const openDropdown = dropdowns[i];
                    if (openDropdown.classList.contains('show')) {
                        openDropdown.classList.remove('show');
                    }
                }
            }
        });

        function updateAirportScore(airportCode, newScore) {
            if (markers[airportCode]) {
                const markerData = markers[airportCode];
                const newColor = getColor(newScore);

                markerData.marker.setStyle({
                    color: newColor,
                    fillColor: newColor
                });

                markerData.marker.setPopupContent(`<b>${airportCode}</b><br>Score: ${newScore}`);
            }
        }

        const originalView = {
            center: [37.0902, -95.7129],
            zoom: 4
        };

        const resetControl = L.control({ position: 'topleft' });

        resetControl.onAdd = function () {
            const div = L.DomUtil.create('div', 'leaflet-control leaflet-control-custom');
            div.innerHTML = '<button style="background: #1a1a1a; color: white; border: none; border-radius: 4px; padding: 5px 10px; cursor: pointer; box-shadow: none;">Reset</button>';
            div.onclick = function () {
                map.setView(originalView.center, originalView.zoom);
            };
            return div;
        };

        function adjustMapHeightToKey() {
            const mapEl = document.getElementById('map');
            const keyBar = document.querySelector('.key-bar');
            if (!mapEl || !keyBar) return;
            const mapRect = mapEl.getBoundingClientRect();
            const keyRect = keyBar.getBoundingClientRect();
            const desiredHeight = Math.max(200, Math.round(keyRect.bottom - mapRect.top));
            mapEl.style.height = desiredHeight + 'px';
            if (map && typeof map.invalidateSize === 'function') {
                map.invalidateSize();
            }
        }

        resetControl.addTo(map);

        window.addEventListener('resize', () => {
            setTimeout(adjustMapHeightToKey, 50);
        });
        setTimeout(adjustMapHeightToKey, 100);
    </script>
</body>
</html>